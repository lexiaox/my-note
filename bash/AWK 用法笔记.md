### 1. AWK ç®€ä»‹

`awk` æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒå…è®¸ä½ å¤„ç†å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚å®ƒæ‰«ææ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œï¼ŒæŸ¥æ‰¾ä¸ŽæŒ‡å®šæ¨¡å¼ç›¸åŒ¹é…çš„å†…å®¹ï¼Œç„¶åŽæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚

`awk` çš„åå­—æ¥æºäºŽå®ƒçš„ä¸‰ä½åˆ›å§‹äººï¼š**A**lfred Ahoã€Peter **W**einberger å’Œ Brian **K**ernighanã€‚

### 2. AWK çš„åŸºæœ¬ç»“æž„

ä¸€ä¸ª `awk` ç¨‹åºé€šå¸¸ç”±ä¸€ç³»åˆ— **æ¨¡å¼-åŠ¨ä½œ** å¯¹ç»„æˆï¼š



```Bash
awk 'pattern { action }' input-file
```

- **`pattern` (æ¨¡å¼):** ç”¨äºŽæŒ‡å®š `awk` åœ¨è¾“å…¥è¡Œä¸­æŸ¥æ‰¾çš„å†…å®¹ã€‚å¦‚æžœçœç•¥ï¼Œåˆ™åŒ¹é…æ¯ä¸€è¡Œã€‚
    
- **`action` (åŠ¨ä½œ):** åœ¨æ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼æ—¶æ‰§è¡Œçš„ä¸€ç³»åˆ—å‘½ä»¤ï¼ˆæŒ‡ä»¤ï¼‰ã€‚å¦‚æžœçœç•¥ï¼Œåˆ™é»˜è®¤æ‰§è¡Œ `{ print $0 }`ï¼ˆæ‰“å°æ•´è¡Œï¼‰ã€‚
    
- **`input-file` (è¾“å…¥æ–‡ä»¶):** è¦å¤„ç†çš„æ–‡ä»¶ã€‚æ•°æ®ä¹Ÿå¯ä»¥æ¥è‡ªæ ‡å‡†è¾“å…¥ï¼ˆ`stdin`ï¼‰æˆ–ç®¡é“çš„è¾“å‡ºã€‚
    

### 3. AWK çš„å·¥ä½œåŽŸç†

`awk` ä¼šé€è¡Œè¯»å–è¾“å…¥ã€‚å¯¹äºŽæ¯ä¸€è¡Œï¼š

1. **åˆ†å‰²è®°å½•ï¼ˆè¡Œï¼‰**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å…¥è¡Œç”±æ¢è¡Œç¬¦åˆ†éš”ã€‚
    
2. **åˆ†å‰²å­—æ®µï¼ˆåŸŸï¼‰**ï¼šæ¯ä¸€è¡Œåˆä¼šè¢«åˆ†å‰²æˆè‹¥å¹²å­—æ®µï¼ˆæˆ–ç§°ä¸ºåŸŸï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå­—æ®µç”±**ä»»æ„ç©ºç™½å­—ç¬¦**ï¼ˆç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ï¼‰åˆ†éš”ã€‚
    
3. **æ¨¡å¼åŒ¹é…**ï¼š`awk` æ£€æŸ¥è¯¥è¡Œæ˜¯å¦ç¬¦åˆç¨‹åºä¸­æŒ‡å®šçš„æ¨¡å¼ã€‚
    
4. **æ‰§è¡ŒåŠ¨ä½œ**ï¼šå¦‚æžœåŒ¹é…æˆåŠŸï¼Œåˆ™æ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œã€‚
    

### 4. å¸¸ç”¨å†…ç½®å˜é‡ï¼ˆé¢„å®šä¹‰å˜é‡ï¼‰

`awk` æœ‰è®¸å¤šå†…ç½®å˜é‡ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ï¼š

| **å˜é‡å**        | **æè¿°**                                          |
| -------------- | ----------------------------------------------- |
| **`$0`**       | å½“å‰è®°å½•ï¼ˆæ•´è¡Œï¼‰çš„æ–‡æœ¬å†…å®¹ã€‚                                  |
| **`$n`**       | å½“å‰è®°å½•çš„ç¬¬ **n** ä¸ªå­—æ®µï¼ˆåŸŸï¼‰ï¼Œä¾‹å¦‚ `$1` æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œ`$2` æ˜¯ç¬¬äºŒä¸ªå­—æ®µã€‚ |
| **`NF`**       | å½“å‰è®°å½•ï¼ˆè¡Œï¼‰ä¸­çš„**å­—æ®µæ•°**ï¼ˆNumber of Fieldsï¼‰ã€‚             |
| **`NR`**       | å½“å‰è®°å½•ï¼ˆè¡Œï¼‰çš„**è¡Œå·**ï¼ˆNumber of Recordï¼‰ã€‚               |
| **`FNR`**      | ä¸Ž `NR` ç±»ä¼¼ï¼Œä½†å®ƒè®°å½•çš„æ˜¯**å½“å‰æ–‡ä»¶**çš„è¡Œå·ã€‚                    |
| **`FS`**       | è¾“å…¥å­—æ®µåˆ†éš”ç¬¦ï¼ˆField Separatorï¼‰ï¼Œé»˜è®¤æ˜¯ä»»æ„ç©ºç™½å­—ç¬¦ã€‚             |
| **`OFS`**      | è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼ˆOutput Field Separatorï¼‰ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªç©ºæ ¼ã€‚        |
| **`RS`**       | è¾“å…¥è®°å½•åˆ†éš”ç¬¦ï¼ˆRecord Separatorï¼‰ï¼Œé»˜è®¤æ˜¯æ¢è¡Œç¬¦ã€‚               |
| **`ORS`**      | è¾“å‡ºè®°å½•åˆ†éš”ç¬¦ï¼ˆOutput Record Separatorï¼‰ï¼Œé»˜è®¤æ˜¯æ¢è¡Œç¬¦ã€‚        |
| **`FILENAME`** | å½“å‰æ­£åœ¨å¤„ç†çš„è¾“å…¥æ–‡ä»¶åã€‚                                   |

### 5. æ ¸å¿ƒå‘½ä»¤å’Œç”¨æ³•

#### A. æ‰“å° (`print`)

æœ€å¸¸è§çš„æ“ä½œæ˜¯æ‰“å°ã€‚

- **æ‰“å°æ•´è¡Œï¼š**
    
    
    
    ```Bash
    awk '{ print $0 }' filename
    # æˆ–çœç•¥åŠ¨ä½œï¼š
    awk '1' filename
    ```
    
- **æ‰“å°æŒ‡å®šçš„å­—æ®µï¼š**
    
    
    
    ```Bash
    awk '{ print $1, $3 }' filename  # æ‰“å°ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå­—æ®µ
    # æ³¨æ„ï¼šå­—æ®µé—´ç”¨é€—å· `,` åˆ†éš”ï¼Œè¾“å‡ºæ—¶ä¼šä½¿ç”¨ OFSï¼ˆé»˜è®¤ç©ºæ ¼ï¼‰è¿žæŽ¥ã€‚
    ```
    
- **æ‰“å°å­—æ®µæ•°ï¼š**
    
    
    
    ```Bash
    awk '{ print NF }' filename # æ‰“å°æ¯ä¸€è¡Œçš„å­—æ®µæ•°é‡
    ```
    

#### B. æŒ‡å®šåˆ†éš”ç¬¦ (`-F` æˆ– `FS`)

å¦‚æžœæ–‡ä»¶çš„å­—æ®µä¸æ˜¯ç”±é»˜è®¤çš„ç©ºç™½å­—ç¬¦åˆ†éš”ï¼ˆä¾‹å¦‚ CSV æ–‡ä»¶ä½¿ç”¨é€—å· `,`ï¼‰ï¼Œä½ éœ€è¦æŒ‡å®šåˆ†éš”ç¬¦ã€‚

- **ä½¿ç”¨ `-F` é€‰é¡¹ï¼š**
    
    
    
    ```Bash
    # ä½¿ç”¨é€—å·ä½œä¸ºè¾“å…¥å­—æ®µåˆ†éš”ç¬¦
    awk -F ',' '{ print $1, $2 }' csv_file.txt
    ```
    
- **ä½¿ç”¨ `BEGIN` å—ä¸­çš„ `FS` å˜é‡ï¼š**
    
    Bash
    
    ```
    awk 'BEGIN { FS=":"; } { print $1 }' /etc/passwd # ä½¿ç”¨å†’å·ä½œä¸ºåˆ†éš”ç¬¦
    ```
    

#### C. ç‰¹æ®Šæ¨¡å¼ï¼ˆ`BEGIN` å’Œ `END`ï¼‰

- **`BEGIN` æ¨¡å¼:** åœ¨è¯»å–ä»»ä½•è¾“å…¥ä¹‹å‰æ‰§è¡Œçš„æ“ä½œï¼Œå¸¸ç”¨äºŽè®¾ç½®å˜é‡æˆ–æ‰“å°æ ‡é¢˜ã€‚
    
    Bash
    
    ```
    awk 'BEGIN { print "--- æŠ¥å‘Šå¼€å§‹ ---"; OFS="\t" } { print $1, $2 } END { print "--- æŠ¥å‘Šç»“æŸ ---" }' filename
    ```
    
- **`END` æ¨¡å¼:** åœ¨è¯»å–å®Œæ‰€æœ‰è¾“å…¥åŽæ‰§è¡Œçš„æ“ä½œï¼Œå¸¸ç”¨äºŽè®¡ç®—æ€»æ•°æˆ–æ‰“å°æ€»ç»“ã€‚
    
    Bash
    
    ```
    awk '{ total += $4 } END { print "ç¬¬å››åˆ—æ€»å’Œ:", total }' filename
    ```
    

#### D. æ¨¡å¼åŒ¹é…

æ¨¡å¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€å…³ç³»è¡¨è¾¾å¼æˆ–ç‰¹æ®Šå—ã€‚

- **æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ˆåŒ…å«ï¼‰ï¼š**
    
    Bash
    
    ```
    # æ‰“å°æ‰€æœ‰åŒ…å« "error" å­—ç¬¦ä¸²çš„è¡Œ
    awk '/error/ { print $0 }' log_file
    ```
    
- **æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ˆä¸åŒ…å«ï¼‰ï¼š**
    
    Bash
    
    ```
    # æ‰“å°æ‰€æœ‰ä¸åŒ…å« "warning" å­—ç¬¦ä¸²çš„è¡Œ
    awk '!/warning/' log_file
    ```
    
- **å…³ç³»è¡¨è¾¾å¼ï¼š**
    
    Bash
    
    ```
    # æ‰“å°è¡Œå·å¤§äºŽ 10 çš„è¡Œ
    awk 'NR > 10 { print $0 }' filename
    # æ‰“å°ç¬¬ä¸€ä¸ªå­—æ®µç­‰äºŽ "Smith" çš„è¡Œ
    awk '$1 == "Smith" { print $0 }' filename
    ```
    
- **ç»„åˆæ¨¡å¼ï¼ˆå¸ƒå°”è¿ç®—ç¬¦ï¼‰ï¼š** `&&` (å’Œ), `||` (æˆ–), `!` (éž)
    
    Bash
    
    ```
    # æ‰“å°è¡Œå·åœ¨ 5 åˆ° 10 ä¹‹é—´ï¼ˆåŒ…å« 5 å’Œ 10ï¼‰çš„è¡Œ
    awk 'NR >= 5 && NR <= 10 { print $0 }' filename
    ```
    

### 6. AWK æŽ§åˆ¶è¯­å¥

`awk` æä¾›äº†ç±»ä¼¼äºŽ C è¯­è¨€çš„é€»è¾‘ç»“æž„ã€‚

- **`if-else` è¯­å¥ï¼š**
    
    Bash
    
    ```
    awk '{ if ($4 > 100) { print $1, "è¶…è¿‡é¢„ç®—" } else { print $1, "åœ¨é¢„ç®—å†…" } }' filename
    ```
    
- **`next` è¯­å¥ï¼š** è·³è¿‡å½“å‰è¡Œçš„å‰©ä½™åŠ¨ä½œï¼Œå¹¶è¯»å–ä¸‹ä¸€è¡Œè¾“å…¥ã€‚
    
    Bash
    
    ```
    # å¦‚æžœç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ "skip"ï¼Œåˆ™è·³è¿‡è¯¥è¡Œ
    awk '$1 == "skip" { next } { print $0 }' filename
    ```
    
- **`exit` è¯­å¥ï¼š** é€€å‡ºä¸»è¾“å…¥å¾ªçŽ¯ï¼Œå¹¶è¿›å…¥ `END` å—ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰ã€‚
    
    Bash
    
    ```
    # è¯»å–å‰ 5 è¡ŒåŽé€€å‡º
    awk 'NR == 5 { exit } { print $0 }' filename
    ```
    

---

### ðŸ’¡ å¯ä»¥å¤åˆ¶çš„ç‰ˆæœ¬ (çº¯æ–‡æœ¬)

åº”ä½ çš„è¦æ±‚ï¼Œè¿™é‡Œæ˜¯ä½ å¯ä»¥ç›´æŽ¥å¤åˆ¶åˆ°ç¬”è®°ä¸­çš„çº¯æ–‡æœ¬ç‰ˆæœ¬ï¼š

```markdow
# AWK ç”¨æ³•ç¬”è®°

## 1. AWK ç®€ä»‹
AWKæ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬å¤„ç†è¯­è¨€ï¼Œç”¨äºŽæ‰«ææ–‡ä»¶ä¸­çš„è¡Œï¼ŒæŸ¥æ‰¾åŒ¹é…çš„æ¨¡å¼ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚

## 2. åŸºæœ¬è¯­æ³•ç»“æž„
awk 'pattern { action }' input-file

## 3. å¸¸ç”¨å†…ç½®å˜é‡
- $0ï¼šå½“å‰æ•´è¡Œè®°å½•ã€‚
- $nï¼šç¬¬ n ä¸ªå­—æ®µï¼ˆåŸŸï¼‰ã€‚
- NFï¼šå½“å‰è¡Œçš„å­—æ®µæ•°é‡ã€‚
- NRï¼šå½“å‰è®°å½•ï¼ˆè¾“å…¥è¡Œï¼‰çš„æ€»è¡Œå·ã€‚
- FNRï¼šå½“å‰æ–‡ä»¶çš„è¡Œå·ã€‚
- FSï¼šè¾“å…¥å­—æ®µåˆ†éš”ç¬¦ï¼ˆé»˜è®¤æ˜¯ä»»æ„ç©ºç™½å­—ç¬¦ï¼‰ã€‚
- OFSï¼šè¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼ˆé»˜è®¤æ˜¯ä¸€ä¸ªç©ºæ ¼ï¼‰ã€‚

## 4. æ ¸å¿ƒå‘½ä»¤å’Œç”¨æ³•
### A. æ‰“å°
- æ‰“å°æ•´è¡Œï¼š
  awk '{ print $0 }' filename
- æ‰“å°ç¬¬1å’Œç¬¬3ä¸ªå­—æ®µï¼š
  awk '{ print $1, $3 }' filename

### B. æŒ‡å®šåˆ†éš”ç¬¦
- ä½¿ç”¨ -F é€‰é¡¹ï¼š
  awk -F ',' '{ print $1, $2 }' csv_file.txt
- ä½¿ç”¨ BEGIN å—ï¼š
  awk 'BEGIN { FS=":"; } { print $1 }' /etc/passwd

### C. ç‰¹æ®Šæ¨¡å¼
- BEGINï¼šåœ¨è¯»å–è¾“å…¥å‰æ‰§è¡Œã€‚
  awk 'BEGIN { print "æ ‡é¢˜" }'
- ENDï¼šåœ¨è¯»å–æ‰€æœ‰è¾“å…¥åŽæ‰§è¡Œã€‚
  awk '{ sum += $4 } END { print "æ€»å’Œ:", sum }' filename

### D. æ¨¡å¼åŒ¹é…
- æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ˆåŒ…å«ï¼‰ï¼š
  awk '/error/' log_file
- å…³ç³»è¡¨è¾¾å¼åŒ¹é…ï¼š
  awk 'NR > 10' filename
- ç»„åˆæ¨¡å¼ï¼š
  awk '$1 == "user" && $NF > 50' filename
```