好的，没问题！为您整理一份关于 `awk` 中 `BEGIN` 和 `END` 块用法的精炼笔记，方便您查阅和学习。

---



`awk` 脚本由三个可选的部分组成：`BEGIN` 块、主处理循环（**模式 {动作}**）和 `END` 块。

### 1. AWK 的执行流程概览

| **阶段**      | **描述**                     | **运行次数**  |
| ----------- | -------------------------- | --------- |
| **启动**      | `awk` 程序启动。                | 1 次       |
| **`BEGIN`** | **在** 读取任何输入数据 **之前** 执行。  | 1 次       |
| **主循环**     | **逐行** 读取输入数据，并根据模式条件执行动作。 | N 次（数据行数） |
| **`END`**   | **在** 处理完所有输入数据 **之后** 执行。 | 1 次       |
| **结束**      | `awk` 程序退出。                | 1 次       |

---

### 2. `BEGIN { ... }` (启动准备区)

**作用：** 用于程序执行前的初始化和配置工作。

|**主要用途**|**描述**|**示例**|
|---|---|---|
|**变量初始化**|设置计数器、累加器、最大/最小值等变量的初始状态。|`BEGIN { min = 999999; sum = 0 }`|
|**打印表头**|打印报告的标题或列名，这些内容只应出现一次。|`BEGIN { print "--- 统计报告 ---" }`|
|**设置分隔符**|设置输入字段分隔符（FS）或输出字段分隔符（OFS）。|`BEGIN { FS = "\t" }` (使用 Tab 分隔符)|

---

### 3. `END { ... }` (结果总结区)

**作用：** 用于所有数据处理完毕后的最终计算和结果输出。

|**主要用途**|**描述**|**示例**|
|---|---|---|
|**输出最终结果**|打印在主循环中累积、计算出的最终统计数据。|`END { print "总平均值: " sum / NR }`|
|**复杂计算**|执行需要完整数据集（如总行数 `NR`）才能完成的复杂计算。|`END { print "处理的总行数: " NR }`|
|**报告收尾**|打印报告的尾部或脚注。|`END { print "--- 报告结束 ---" }`|

---

### 4. 案例回顾（Max/Min）

在您的暴力犯罪分析任务中，`BEGIN` 和 `END` 的应用是教科书式的：

Awk

```
awk -F, '
    BEGIN {          # 启动时执行：初始化 min/max
        min=9999999999; 
        max=0         
    }
    NR > 4 {         # 主循环：逐行读取数据，更新 min/max
        # ... 数据处理逻辑 ...
    }
    END {            # 结束时执行：输出最终结果
        print "最小值 (Min): " min; 
        print "最大值 (Max): " max
    }
' "cleaned_data.csv"
```