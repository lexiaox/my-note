
---
tags: [HPC, OpenMP, C-Language]
updated: <% tp.date.now("YYYY-MM-DD") %>

---

# ğŸš€ OpenMP æ ¸å¿ƒæŒ‡ä»¤ä¸å¹¶å‘æ¨¡å‹

## 1. å¹¶è¡ŒåŒºåŸŸå£°æ˜ (Parallel Region)
æœ€åŸºæœ¬çš„å¹¶è¡Œå…¥å£ã€‚
```c
#pragma omp parallel
{
    // æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œä¸€éæ­¤å¤„çš„ä»£ç 
    int tid = omp_get_thread_num();
    printf("Hello from thread %d\n", tid);
}
````

## 2. å¾ªç¯å¹¶è¡ŒåŒ– (Work Sharing)

å°† `for` å¾ªç¯çš„è¿­ä»£åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹ã€‚

- **å…³é”®é™åˆ¶**ï¼šå¾ªç¯è¿­ä»£æ¬¡æ•°å¿…é¡»æ˜¯å¯é¢„æµ‹çš„ï¼ˆä¸èƒ½æœ‰ breakï¼‰ã€‚
    
```C
#pragma omp parallel for
for (int i = 0; i < 100; i++) {
    // è¿­ä»£è¢«è‡ªåŠ¨åˆ‡åˆ†ç»™å„ä¸ªçº¿ç¨‹
}
```

## 3. æ•°æ®ç¯å¢ƒ (Data Environment) ğŸ›¡ï¸

è¿™æ˜¯ OpenMP ç¬”è®°ä¸­æœ€å®¹æ˜“å‡ºé”™çš„éƒ¨åˆ†ï¼Œå¿…é¡»é‡ç‚¹è®°å½•ï¼š

|**æŒ‡ä»¤**|**ä½œç”¨**|**é€‚ç”¨åœºæ™¯**|
|---|---|---|
|**shared**|å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚|åŸºç¡€æ•°æ®ã€åªè¯»æ•°ç»„ã€‚|
|**private**|æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è¯¥å˜é‡çš„ç‹¬ç«‹æ‹·è´ï¼Œ**ä¸åˆå§‹åŒ–**ã€‚|å¾ªç¯å†…éƒ¨çš„ä¸´æ—¶å˜é‡ï¼ˆå¦‚ $i$ï¼‰ã€‚|
|**firstprivate**|æ¯ä¸ªçº¿ç¨‹æ‹·è´ä¸€ä»½å‰¯æœ¬ï¼Œå¹¶ç”¨ä¸»çº¿ç¨‹çš„å€¼**åˆå§‹åŒ–**ã€‚|éœ€è¦åˆå§‹å€¼çš„å±€éƒ¨å˜é‡ã€‚|
|**lastprivate**|å¾ªç¯ç»“æŸåï¼Œå°†æœ€åä¸€ä¸ªè¿­ä»£çš„å€¼å†™å›ä¸»çº¿ç¨‹ã€‚|éœ€è¦å¾ªç¯æœ€åçŠ¶æ€çš„åœºæ™¯ã€‚|

## 4. è§„çº¦æ“ä½œ (Reduction) âš¡

ç”¨äºè§£å†³â€œå†™å†²çªâ€ï¼ˆå¦‚ç´¯åŠ  sumï¼‰ã€‚

- **åŸç†**ï¼šæ¯ä¸ªçº¿ç¨‹æœ¬åœ°ç§æœ‰ç´¯åŠ ï¼Œæœ€åç”± OpenMP è‡ªåŠ¨æ‰§è¡ŒåŸå­åŠ æ³•ã€‚
    
- **è¯­æ³•**ï¼š`#pragma omp parallel for reduction(+:sum)`
    

## 5. ä»»åŠ¡è°ƒåº¦ (Schedule)

è§£å†³è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒå‚æ•°ã€‚

- `static [,chunk]`: é™æ€åˆ†é…ï¼Œå¼€é”€å°ã€‚
    
- `dynamic [,chunk]`: åŠ¨æ€é¢†ä»»åŠ¡ï¼Œé€‚åˆè¿­ä»£è€—æ—¶ä¸å‡çš„æƒ…å†µã€‚
    
- `guided`: å—å¤§å°æŒ‰æŒ‡æ•°é€’å‡ã€‚
    

---

## ğŸ› ï¸ IT å¸¸ç”¨è°ƒè¯•å‘½ä»¤

Bash

```
# è®¾ç½®çº¿ç¨‹æ•°ï¼ˆæ— éœ€ä¿®æ”¹ä»£ç ï¼‰
export OMP_NUM_THREADS=8

# ç¼–è¯‘å¸¦ OpenMP æ”¯æŒçš„ C ä»£ç 
gcc -O2 -fopenmp my_code.c -o my_code
```

> [!NOTE] å…°å¤§è¯¾ä»¶å…³è” (p.28-35)
> 
> é‡ç‚¹å¤ä¹  é™æ€è°ƒåº¦ æ—¶çš„è½®è¯¢ (Round-Robin) åˆ†é…é€»è¾‘ã€‚



---




## å»ºè®®åœ¨ Obsidian ä¸­å¦‚ä½•åˆ©ç”¨è¿™ä»½æ¸…å•ï¼š

1. **å»ºç«‹ç´¢å¼•**ï¼šåœ¨ä½ çš„ MOC ç¬”è®°ä¸­ï¼Œç”¨ `[[01-OpenMP-Basics]]` é“¾æ¥åˆ°æ­¤é¡µã€‚
2. **æ·»åŠ å®éªŒé“¾æ¥**ï¼šåœ¨ `reduction` ç« èŠ‚ä¸‹ï¼Œç›´æ¥æ·»åŠ ä¸€ä¸ª `[[Lab-Pi-Calculation]]` çš„é“¾æ¥ã€‚
3. **é…åˆ Callout**ï¼šä½¿ç”¨ `> [!BUG]` è®°å½•ä½ è¸©è¿‡çš„å‘ï¼ˆæ¯”å¦‚å¿˜è®°æŠŠå¾ªç¯å˜é‡ $i$ è®¾ä¸º private å¯¼è‡´çš„ç«æ€æ¡ä»¶ï¼‰ã€‚


